<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

        <!--Import Google Icon Font-->
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
        <!-- Compiled and minified CSS -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    
        <!--Import materialize.css-->
        <!-- <link type="text/css" rel="stylesheet" href="css/materialize.min.css"  media="screen,projection"/> -->
    
        <!--Let browser know website is optimized for mobile-->
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/> 
        
        <!-- FontAwesome -->
        <script src="https://kit.fontawesome.com/043a87e592.js" crossorigin="anonymous"></script>
        
    <title>Junkie Awesome</title>

    <style>
    body {
        /* padding:10px; */
    }
    #searchFoods {
        margin:10px;
    }
    .food-btn{
        width: 90px;
        height: 45px;
        background-color: white;
        color:#ffa726;
        font-size: 22px;
        /* font-weight: bold; */
        margin: 10px 10px 10px 10px;
    }
    #header{
        margin: 10px;
        padding:0px;
    }
    /* .slider {
        height: 200px;
    } */

    #buttonList, #beerOutput, #movies-view {
        padding :20px;
    }
    #searchBar {
        height:90px;
    } 
    #beerView, #moviesView {
        width: 600px;
        height: 630px;
        border: 1px solid rgb(252, 243, 243);
        border-radius:30px;
        padding: 15px;
        /* box-shadow: 10px 10px 5px rgb(219, 213, 213); */
        background-image: linear-gradient(to bottom right, rgb(250, 209, 209), rgb(252, 249, 249), rgb(252, 231, 185)); */
        z-index:-1;
    }

    #controls {
        margin:20px 0 0 20px;
    }

    .beerInformation {
        font-size: 17px;
        margin:0 0 0 20px;
    }

    .moviesInformation {
        font-size:18px;
        margin:0 0 0 20px;
    }
    .page-footer{
        margin-bottom: 0px;
    }
    .container.center {
        /* margin: 0px 0px 10px 0px; */
    }
    @media all and (max-width: 750px) {
          
        #beerView, #moviesView {
            width: 95%;
            /* height: 500px; */}
        }
    </style>
</head>
<!-- ======================================================================= -->
<body>
    <audio id= "pop">
        <source src="audio/aLovelyWayToSpendAnEvening.mp3" type="audio/mpeg">
        <source src="audio/groove.mp3" type="audio/mpeg">
    </audio>

    <!-- Nav bar -->  
    <div class="navbar-fixed">
        <nav class="teal deep-orange lighten-3">
            <div class= "container">
                <div class="nav-wrapper"> 
                    <a href="#!" class="brand-logo center col s12" ><h4 id="header">Junkie Awesome</h4></a>
                </div>
            </div>
        </nav>
    </div>

    <!-- Carousel -->  
    <div class="slider">
            <ul class="slides">
              <li>
                <img src="imgShine/20191031_121029.png"> <!-- random image -->
                <div class="caption center-align">
                  <h3>Start with your food!</h3>
                  <h5 class="light grey-text text-lighten-3 hide-on-small-only">Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book.</h5>
                </div>
              </li>
              <li>
                <img src="imgShine/20191031_121209.png"> <!-- random image -->
                <div class="caption left-align">
                  <h3>Beer along with your food!</h3>
                  <h5 class="light grey-text text-lighten-3 hide-on-small-only">Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book.</h5>
                </div>
              </li>
              <li>
                <img src="imgShine/20191031_121630.png"> <!-- random image -->
                <div class="caption right-align">
                  <h3>Time to dive in your movie!!</h3>
                  <h5 class="light grey-text text-lighten-3 hide-on-small-only">Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book.</h5>
                </div>
              </li>              
            </ul>
          </div>

    <!-- Section: search -->             
    <section id="search" class="section section-search deep-orange lighten-3 white-text center scrollspy">
        <div class="container">
            <div class="row">
                <div id="searchBar" class="col s12">
                    <h4 id="searchFoods">Search Foods</h4>
                    <!-- <form id="food-form"> -->
                            <!-- <label for="food-input">What food would you like to search?</label> -->
                            <input type="text" id="food-input" class="white grey-text autocomplete" placeholder="cheese, steak, apple, etc...">
                                              
                            <!-- Buttontriggers new movie to be added -->
                            <!-- <input id="search" type="submit" value="Search">  -->
                    <!-- </form> -->
                </div>
            </div>
        </div>
    </section>       

    <!-- Button list -->   
    <div id="buttonView"></div>

    <audio controls id="controls">
            <source src="audio/aLovelyWayToSpendAnEvening.mp3" type="audio/mpeg">
            <source src="audio/groove.mp3" type="audio/mpeg">
          </audio>

    <div class="beerInformation">
        <h4 class="header">Beer with the Food!</h4>
        <div class= "beerUl">
            <ul id="beerView">
                <li class= "beerLi"></li>
            </ul>
        </div>
    </div> 
    
    <div class="moviesInformation">
        <h4 class="header">Movie with the Beer!</h4>
        <div class= "movieUl">
            <ul id="moviesView">
                <li class= "movieLi"></li>
            </ul>
        </div>
    </div> 

    <footer class="page-footer deep-orange lighten-3">
        <div class="container center">
            © 2019 Copyright JavaScript Junkies
        </div>
    </footer>
</body>


<!-- ===================================================================== -->

<!-- Compiled and minified JavaScript -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script> -->
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>     -->
    
  <script text="text/javascript">

    //slider
    const slider = document.querySelector('.slider');
    M.Slider.init(slider, {
        indicators: false,
        height: 400,
        transition: 500,
        interval:4000
    });    

    $(document).ready(function() {  

        $('audio#pop')[1,0].play();      

        var foodButton= [];
        var beerYear= [];

    //1. When a user put a name, the buttons with the names of the food are generated.

        function arrayButtons() {
            console.log(1);
            console.log(beerYear)
            $("#buttonView").empty();

            for (var i= 0; i < foodButton.length; i++) {

                var button = $("<button>");

                button.addClass("food-btn");
                button.attr("data-name", foodButton[i]);      
                button.attr("data-year", beerYear[i]);            
                button.text(foodButton[i]);

                $("#buttonView").prepend(button);
            }
        } 

    //2. The user press enter, the food name is stored in 'newFood' and added in the 'foodButton' array.
       
        $("#food-input").keypress(function(event){ 

        // $("#search").on("click", function(event) {             
           
            if(event.which === 13){
                var newFood = $("#food-input").val().trim();
                    // if(newFood) {
                        // addFood(newFood);
                        foodButton.push(newFood);
                    // }
                newFood.val = "";                
            }
            
            // newFood 를 블러야 실행이 되는 것인데 실행시키지 않았었던 것
            // --> It executes only when I call getBeerData(newFood), but I didn't
            // newFood 버튼을 설정하고, 부르고, api 기능으로 실행시키는 것
            // --> Set the newFood button, Call it, execute with API
            getBeerData(newFood);            
        });

    //3. All the food name buttons will do a certain function,
    //   when the user click any food button, the 'data-name' is stored in 'newFood'
    //   and it will call the getting beer data and getting movie data.

        // $(document).on("click", ".food-btn", getBeerData);
        $(document).on("click", ".food-btn", function(){
            // console.log(3);
            
            var newFood= ($(this).attr("data-name")); 
            console.log($(this).attr("data-year"));
            getBeerData(newFood);
            getMovieData(year);
        });

    //4. The user gets the beer data with the user's food input
    //   and when getting the beer data, the year of the beer is selected, stored and added the 'beerYear' array

        function getBeerData(newFood) {
            
            // var APIKey = "472257543d9345308ea5ac03e502def3";  
            var userInput = newFood;
            var queryURL = "https://api.punkapi.com/v2/beers/?food=" + userInput;
            
            $.ajax({
                url: queryURL,
                method: "GET"          

            }).then(function(response) {
                // console.log("4");
                console.log(response);

                var random = Math.floor(Math.random()*response.length);
                var year = response[random].first_brewed.slice(3);               

                // console.log(response[0].first_brewed.slice(3));
                beerYear.push(year);

                arrayButtons();  // year 를 받기 전에 콜을 불렀기 때문에 아무것도 안나왔던것.
                                 // --> I didn't get anything, because I call arrayButtons(), before I get the year data
                                 // --> Now I get the year data, because I call arrayButton after I get the year data from API 
                showBeerData(response, random);
                getMovieData(year);
                //  $("#beerOutput").text(JSON.stringify(response));                
            });
        }

    //5. With the random choose in the beer data, now its data is populating to the '#beerView' in the HTML.

        function showBeerData(response, random) {
            // console.log("random");            

            $("#beerView").empty();

            var beerDiv = $("<div class= 'beerData'>");

            var name = response[random].name;            
            var firstBrewed = response[random].first_brewed.slice(3);            
            var description = response[random].description;
            var foodPairing = response[random].food_pairing;
            
            var pOne = $("<h5>").html("BeerName :  " + name);
            var pTwo = $("<h6>").html("FirstBrewed :  " + firstBrewed);                      
            var pThree = $("<h6>").html("Description : " +  '<br>' + description);
            var pFour = $("<h6>").html("Food_paring : " +  '<br>' + foodPairing);

            var imageURL = response[random].image_url;
            var img = $("<img>").attr("src", imageURL);
            img.attr("style", 'height:300px; margin:0 auto;');
            beerDiv.append(img);

            beerDiv.append(pOne);
            beerDiv.append(pTwo);               
            beerDiv.append(pThree);
            beerDiv.append(pFour);

            $("#beerView").append(beerDiv);

            // beerDiv.attr("style", 'height:500px;width:500px;display:inline-block;border:1px solid black;vertical-align:top;');
        }        

    //6. Finally, we're getting the movie data with the year which is randomly selected ans stored above.

        function getMovieData(year) {            
            
            // var movie = $(this).attr("data-name");
            // var year = firstBrewed;
            var queryURL = "http://www.omdbapi.com/?apikey=3f779744&t=beer&y=" + year;
                  
            $.ajax({
              url: queryURL,
              method: "GET",
            }).then(function(response) {             
                // console.log("6");
                // console.log(response);

                // showFoodData(response);
                showMovieData(response);
            });
        }

     //7. The movie data is populating on the '#movieView' in the HTML
     
        function showMovieData(response) {
            // console.log("7");

            $("#moviesView").empty();

            var movieDiv = $("<div class='movie'>");          
            
            var title = response.Title;
            var plot = response.Plot;
            var director = response.Director;
            var actors = response.Actors;           
            var country = response.Country;

            var pOne = $("<p>").text("Title: " + title);
            var pTwo = $("<p>").text("Plot: " + plot);
            var pThree = $("<p>").text("Director: " + director);
            var pFour = $("<p>").text("Actors: " + actors);            
            var pFive = $("<p>").text("Country: " + country);                  
                
            var imgURL = response.Poster;
            var image = $("<img>").attr("src", imgURL);
            image.attr("style", 'height:300px; margin:0 auto;');           
            movieDiv.append(image);
            
            movieDiv.append(pOne);
            movieDiv.append(pTwo);
            movieDiv.append(pThree);
            movieDiv.append(pFour);
            movieDiv.append(pFive);

            $("#moviesView").append(movieDiv);
        }      

    arrayButtons();
        
    });
  </script> 

</body>
</html> 